# 清单 A：针对“小车时走时停”

这说明噪声的幅度超过了设定的阈值。

## 1. 软件参数调试（由易到难）

[ ] 提高判定阈值

操作：增大 SLOPE_THRESHOLD_PRE （减速阈值）和 SLOPE_THRESHOLD_LONG （停车阈值）。

建议：例如将 PRE 从 5 改为 8，将 LONG 从 10 改为 15。

原理：抬高门槛，让普通的电机噪声“跨不过去”。

[ ] 增加硬件采样次数

操作：增大 ADC_OVERSAMPLE_CNT。

建议：从 16 改为 32 或 64。

原理：采样次数越多，平均值越平滑，瞬时尖峰被削弱得越厉害。

[ ] 缩小滑动窗口（慎用）

操作：减小 WINDOW_SIZE。

建议：如果当前是 10（100ms），尝试改为 5（50ms）。

原理：虽然这会降低灵敏度，但也减少了噪声累积的可能性（特别是低频漂移噪声）。

注意：这可能会导致难以识别真实信号，需配合“清单B”平衡。

# 清单 B：针对“小车一直走”

这说明信号被过滤掉了，或者信号强度未达标。

## 1. 软件参数调试（由易到难）

[ ] 降低判定阈值

操作：减小 SLOPE_THRESHOLD_PRE 和 SLOPE_THRESHOLD_LONG。

建议：例如将 PRE 降为 3，LONG 降为 7。

原理：降低门槛，让微弱的电压上升也能触发逻辑。

[ ] 扩大滑动窗口（关键）

操作：增大 WINDOW_SIZE。

建议：从 10（100ms）增大到 20（200ms）甚至 30（300ms）。

原理：这是解决“高电压充电慢”的核心。 时间越长，电压累积上升的数值就越大，delta_long 就会显著增加，从而变得容易识别。

[ ] 降低基础车速

操作：减小 BASE_SPEED。

建议：尝试降低 20%~30%。

原理：车速太快，经过线圈的时间（例如仅50ms）小于窗口时间（100ms），导致窗口还没“填满”信号，车就已经离开了。慢下来能让窗口吸收到完整的电压上升过程。

## 2. 逻辑/物理排查

[ ] 检查减速逻辑是否生效

观察：经过桩时，车速有变化吗？

分析：

如果有减速但没停：说明检测到了微弱信号（触发了 PRE 阈值），但信号不够强（没触发 LONG）。对策：增大窗口大小。

如果完全没减速：说明连微弱信号都没抓到。对策：降低阈值 + 检查线圈距离。

# 总结：调试流程图

先治“乱动” (清单 A)：先保证小车在平地上跑绝对不会误判停车。通过加电容、提高阈值，把误触发率降为 0。

后治“眼瞎” (清单 B)：在不误判的前提下，通过增大窗口 (WINDOW_SIZE) 来提高对真实信号的灵敏度。

最后调“速度”：如果实在识别不到，适当降低车速，给 ADC 更多反应时间。